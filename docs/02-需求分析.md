# 审批系统 - 需求分析文档

## 1. 项目背景

在企业信息化系统中，审批流程是最常见、最基础的业务场景之一，如请假审批、报销审批、用章审批等。传统的纸质或半手工审批流程存在以下痛点：

-  流程不透明，难以追踪审批进度
-  审批效率低，流程长、容易堆积
-  纸质文档管理混乱，数据易缺失
-  统计分析困难，无法沉淀经验
-  难以满足跨地域、异地办公场景

本系统旨在构建一个**可配置、可扩展的企业级审批流程管理平台**，以统一的账号体系、岗位权限模型和多端数字化体验解决上述问题，实现审批事项的电子化、流程化和智能化。系统分为前端工作台、后端服务与数据库三层，通过 RESTful API 实现端到端闭环。

## 2. 用户角色分析

### 2.1 普通员工

- **角色定位**：发起审批申请的主体，通常来自不同部门、岗位。
- **核心需求**：
  - 完成注册/登录并激活个人资料。
  - 发起请假、报销等标准申请，上传附件。
  - 在“我的申请”中查看状态、审批历史、附件及个人仪表盘统计。
  - 在审批未开始或待办阶段撤回申请并重新提交。
- **权限边界**：仅能访问本人创建的申请与统计，无法读取其他员工的数据。

### 2.2 审批人（部门经理/领导）

- **角色定位**：具备审批权限的岗位成员，通常由部门经理或指定领导担任。
- **核心需求**：
  - 获取系统自动分派的待办任务列表，支持快速筛选和排序。
  - 在审批详情中查看申请信息、附件、历史与上下节点，执行同意/拒绝/转办等动作。
  - 通过审批人仪表盘掌握近7日/30日的审批量、通过率、类型拆分、趋势图等指标。
- **权限边界**：仅能处理与本人岗位绑定的任务，但可查看对应申请的全部上下文信息。

### 2.3 系统管理员

- **角色定位**：负责全局配置与运维，通常属于信息化/HR 团队。
- **核心需求**：
  - 管理用户、部门、岗位、岗位权限、角色以及审批模板。
  - 为注册用户分配岗位与角色，确保岗位-权限绑定生效，并可即时停用账号。
  - 访问全量审批数据、统计报表、导出文件及审计日志。
- **权限边界**：拥有读写全库的系统权限，需要通过操作日志记录所有关键动作。

## 3. 功能范围

### 3.1 必做功能（MVP）

#### 3.1.1 身份与权限管理
- **注册**：用户名、密码、确认密码、真实姓名、手机号、邮箱；校验用户名唯一性，注册成功默认普通员工角色。
- **登录与鉴权**：基于 JWT 的无状态认证，支持图形/滑动验证码扩展；Token 放入 Header，后端统一拦截校验。
- **岗位-权限模型**：岗位承载审批能力，岗位与权限（菜单、接口、数据范围）绑定，用户与岗位一对多；权限变更需实时生效。
- **用户/部门/岗位管理**：管理员可增删改查用户、部门、岗位，支持部门树结构、岗位排序、启停状态及岗位负责人设置。

#### 3.1.2 员工工作台
- **表单申请**：提供请假、报销两类标准表单；字段含类型、时间、金额、事由、附件等，校验规则与默认值由后端控制。
- **附件上传**：支持 jpg/png/gif/pdf/doc/docx，单个文件 <=10MB，同一申请最多 5 个附件，上传后立即生成可预览链接。
- **我的申请**：展示申请单号、类型、发起时间、当前状态，支持按类型/时间/状态筛选；可查看详情、附件、时间轴历史。
- **撤回与重提**：待审批状态可撤回，撤回后状态变为已撤回，记录撤回说明并允许重新发起。
- **个人仪表盘**：统计个人申请总数、通过数、拒绝数、通过率、请假天数、报销金额，支持按本周/本月/本年切换。

#### 3.1.3 审批人工作台
- **待办列表**：展示申请类型、申请人、提交时间、剩余 SLA；支持关键词检索与状态筛选。
- **审批动作**：同意、拒绝、转交（可选）、加签（可选），审批意见支持富文本或至少 200 字限制，提交后写入审批历史。
- **已办列表**：记录已处理任务，便于追溯与复核。
- **审批人仪表盘**：包含今日/本周/本月任务量、通过率、平均处理时长、类型分布、月度趋势等，支持导出 PNG/CSV（可选）。

#### 3.1.4 审批流程与指派机制
- **部门审批指派**：员工提交申请时需选择具备审批权限且同部门的岗位/人员，后端二次校验并生成任务；若部门无审批人则阻止提交。
- **多级节点**：请假/报销默认配置申请人部门经理，可扩展至部门经理财务总经理。
- **会签/或签**：支持同一节点多个审批人，配置会签（全部同意）与或签（任意一人同意）。
- **审批人选择器**：树形展示部门岗位人员，支持关键词搜索与常用审批人收藏。

#### 3.1.5 系统管理中心
- **用户管理**：账号创建、编辑、禁用、密码重置、岗位与角色绑定；支持批量导入/导出。
- **部门管理**：树形组织维护、负责人设置、排序、启停。
- **岗位管理**：岗位基础信息、审批阈值（金额/天数）、审批范围配置；岗位与权限关联。
- **权限管理**: 维护权限编码、名称、类型（菜单/按钮/API），并分配给岗位；同步更新前端菜单。
- **审批数据总览**：管理员可检索全量审批单、导出报表、查看附件。

#### 3.1.6 文件与附件管理
- 统一的上传、预览、下载接口；支持断点续传（可选）。
- 权限控制：仅申请人、当前审批人、管理员可访问附件；访问记录写入审计日志。
- 文件落盘策略：本地磁盘（upload 目录）+ 定期归档，预留切换对象存储的配置。

#### 3.1.7 统计与报表
- **个人统计**：见 3.1.2 个人仪表盘。
- **审批人统计**：见 3.1.3 仪表盘。
- **管理员统计**：部门申请量、岗位人数、月度通过率、关键指标对比、部门明细弹窗；提供折线/柱状/饼图及表格双视图。
- **导出**：管理员可将统计结果导出为 CSV/Excel，涵盖原始数据与指标。

### 3.2 选做功能（增强版）

#### 3.2.1 动态表单配置
- 拖拽式表单设计器，支持文本、数字、下拉、单选、多选、日期、日期时间、文件等控件。
- 字段属性：名称、唯一标识、是否必填、默认值、正则校验、占位提示、联动规则。
- 表单模板版本管理：允许启停、复制、回滚，并提供预览模式。

#### 3.2.2 动态流程设计
- BPMN 风格流程设计器（推荐 bpmn-js），支持开始、审批、条件、并行会签、结束等节点。
- 条件分支：可根据表单字段（如金额、请假天数）配置不同路径。
- 流程版本化：保留历史版本、差异对比、一键切换；新申请使用最新版本，旧单据保持原流程。

#### 3.2.3 报表排程与导出
- 预设报表任务，按日/周/月定时生成统计并推送至管理员邮箱或企业微信。
- 支持导出 PDF、Excel、图像，并在系统内保留下载记录。

#### 3.2.4 通知与集成
- 消息中心：站内信、邮件、企业微信/钉钉机器人等多渠道通知。
- Webhook：审批通过/拒绝事件可回调第三方系统。

## 4. 非功能需求

### 4.1 性能要求
- 单接口响应时间 < 2s（95 分位），核心列表分页接口 < 1.5s。
- 支持 100 个并发在线用户、500 条/分钟的审批操作峰值。
- 所有复杂统计查询需结合索引与缓存，确保 < 3s。

### 4.2 安全要求
- 密码使用 BCrypt 加密；JWT 密钥定期轮换。
- API 需进行权限校验、SQL 注入防护、XSS/CSRF 防御。
- 附件访问需带鉴权签名，下载链接限定时效。

### 4.3 可用性要求
- 系统可用性  99%，支持 7x24 小时运行。
- 关键配置与审批数据需每日自动备份；附件按周备份。
- 异常恢复时间（RTO） < 4 小时，数据恢复点（RPO） < 30 分钟。

### 4.4 兼容性要求
- Web 端支持 Chrome、Edge、Firefox、Safari 最新两个大版本。
- 支持大屏 1440px 与常见笔记本分辨率，移动端以响应式方案兼容核心功能（可选）。

### 4.5 可扩展性要求
- 模块化设计，支持新增业务表单、流程节点、统计报表。
- 权限与岗位模型需便于横向扩展，例如新增财务审批人人力专员等岗位。
- 预留多租户与国际化扩展接口。

## 5. 数据字典（简化版）

### 申请状态
| 状态值 | 状态名称 | 说明 |
|-------|---------|------|
| 0 | 草稿 | 申请已保存但未提交 |
| 1 | 待审批 | 申请已提交，等待第一位审批人 |
| 2 | 审批中 | 多级审批流程执行中 |
| 3 | 已通过 | 全部审批节点完成且通过 |
| 4 | 已拒绝 | 任一节点拒绝 |
| 5 | 已撤回 | 申请人在待审阶段撤回 |

### 审批动作
| 动作值 | 动作名称 | 说明 |
|-------|---------|------|
| 1 | 同意 | 审批人同意申请 |
| 2 | 拒绝 | 审批人拒绝申请 |
| 3 | 转发 | 将任务转交给其他审批人 |
| 4 | 加签 | 在当前节点追加审批人 |

### 请假类型
| 类型值 | 类型名称 |
|-------|---------|
| 1 | 事假 |
| 2 | 病假 |
| 3 | 年假 |
| 4 | 调休 |

### 报销类型
| 类型值 | 类型名称 |
|-------|---------|
| 1 | 差旅费 |
| 2 | 餐饮费 |
| 3 | 办公费 |
| 4 | 其他 |

## 6. 业务流程图

### 6.1 请假申请流程
```
员工发起请假申请
  ↓
填写请假表单并上传附件
  ↓
系统校验岗位/审批人、生成申请单号
  ↓
提交申请（状态：待审批）
  ↓
系统分配给对应部门经理
  ↓
部门经理审批
  ├─ 同意 → （若有后续节点继续流转 / 否则进入已通过）
  └─ 拒绝 → 申请拒绝 → 结束
```

### 6.2 报销申请流程（带条件分支）
```
员工发起报销申请
  ↓
填写报销表单 + 发票附件
  ↓
提交申请
  ↓
系统判断报销金额或配置阈值
  ├─ < 1000元 → 部门经理审批 → 结束
  └─ ≥ 1000元 → 部门经理审批 → 财务经理审批 → 结束
```

### 6.3 审批撤回流程
```
员工查看“我的申请”
  ↓
选择状态为待审批的申请
  ↓
点击撤回并确认
  ↓
系统更新状态为“已撤回”并记录操作
  ↓
通知相关审批人（可选）
  ↓
结束
```

## 7. 用户故事（User Story）

### US-001: 员工发起请假申请
- **作为**：普通员工
- **我想要**：在系统中发起请假申请
- **以便于**：向上级申请休假并记录审批过程
- **验收标准**：
  - [ ] 可以选择请假类型并设定起止时间，系统自动计算天数。
  - [ ] 表单需校验必填项，允许上传附件。
  - [ ] 提交后申请状态切换为待审批，并出现在我的申请。

### US-002: 审批人处理审批任务
- **作为**：审批人
- **我想要**：查看并处理分配给我的审批任务
- **以便于**：及时审批下属的申请
- **验收标准**：
  - [ ] 可以查看待办列表与申请详情。
  - [ ] 可以执行同意/拒绝操作，填写审批意见。
  - [ ] 审批结果实时同步到申请历史并通知申请人。

### US-003: 员工撤回申请
- **作为**：普通员工
- **我想要**：撤回尚未开始审批的申请
- **以便于**：修改错误信息后重新提交
- **验收标准**：
  - [ ] 仅当申请状态为待审批时显示撤回按钮。
  - [ ] 撤回操作需二次确认，记录撤回原因。
  - [ ] 撤回后申请状态为已撤回，不可继续审批。

### US-004: 员工注册账号
- **作为**：新员工
- **我想要**：自主注册系统账号
- **以便于**：快速开始使用审批系统
- **验收标准**：
  - [ ] 注册表单校验用户名唯一性、密码一致性。
  - [ ] 注册成功后默认为普通员工角色。
  - [ ] 用户可立即登录并等待管理员分配岗位。

### US-005: 管理员分配角色与岗位
- **作为**：系统管理员
- **我想要**：为注册用户分配不同角色/岗位
- **以便于**：控制用户的权限
- **验收标准**：
  - [ ] 可以查看所有注册用户及其当前岗位。
  - [ ] 可以为用户分配岗位（继承岗位权限）并设置角色。
  - [ ] 角色/岗位变更需实时生效并记录日志。

### US-006: 审批人查看仪表盘
- **作为**：审批人
- **我想要**：查看近阶段审批指标
- **以便于**：了解工作量和处理效率
- **验收标准**：
  - [ ] 仪表盘展示 KPI（任务量、通过率、平均耗时）。
  - [ ] 提供类型拆分与月度趋势图。
  - [ ] 数据与待办/已办列表一致且支持时间范围筛选。

### US-007: 管理员配置岗位权限
- **作为**：系统管理员
- **我想要**：为岗位绑定权限点
- **以便于**：保证岗位与功能能力对应
- **验收标准**：
  - [ ] 可在岗位详情页选择菜单、按钮、API 权限。
  - [ ] 保存后立即影响所属用户权限。
  - [ ] 操作需记录审计日志。

### US-008: 管理员查看统计报表
- **作为**：系统管理员
- **我想要**：查看部门/岗位层面的审批统计
- **以便于**：进行绩效评估与资源配置
- **验收标准**：
  - [ ] 可以按时间范围、部门筛选统计数据。
  - [ ] 同时展示图表与表格，并支持导出。
  - [ ] 点击部门可查看明细弹窗。

### US-009: 员工选择部门审批人
- **作为**：普通员工
- **我想要**：在提交申请时选择符合条件的审批人
- **以便于**：确保流程准确流转
- **验收标准**：
  - [ ] 审批人选择器按照部门岗位人员展示。
  - [ ] 仅显示具备对应审批权限的人员。
  - [ ] 若无可选审批人，系统给出指引并阻止提交。

## 10. 验收标准

### MVP 版本验收标准
- [ ] 用户可以注册、登录并通过 JWT 鉴权。
- [ ] 员工可以发起请假、报销申请，上传附件并查看审批历史。
- [ ] 审批人可以处理待办任务，审批历史完整可追踪。
- [ ] 员工可以撤回待审批申请并查看个人仪表盘。
- [ ] 审批人仪表盘展示关键指标。
- [ ] 管理员可以管理用户/部门/岗位/岗位权限，并查看全部审批数据与统计报表。
- [ ] 系统响应时间 < 2 秒且无严重 Bug。

### 完整版本验收标准（包含选做功能）
- [ ] 支持动态表单和流程设计、版本管理。
- [ ] 支持条件分支、会签/或签等高级流程能力。
- [ ] 支持报表排程、导出 PDF/Excel、消息通知。
- [ ] 文件上传支持在线预览、权限校验及审计。
- [ ] 安全、性能、可用性测试通过，满足非功能指标。

---

>  **文档版本**：v1.1  
>  **最后更新**：2026-01-20  
>  **编写人**：系统架构师
