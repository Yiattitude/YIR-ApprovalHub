# 审批人仪表盘功能说明

## 1. 功能概述
审批人仪表盘用于帮助审批人员快速了解个人审批情况。页面由三大区域组成：
- **审批人信息**：展示姓名、部门、岗位与权限标签。
- **关键指标卡片**：累计审批数量、同意数、拒绝数。
- **统计分析**：
  - 按申请类型的审批数量卡片。
  - 按月份的审批趋势折线图。

所有数据均来源于后端 `/task/dashboard` 接口，针对当前登录审批人按需聚合。

## 2. 后端实现
位置：[approval-backend/src/main/java/com/approval/module/approval](../approval-backend/src/main/java/com/approval/module/approval)

### 2.1 新增 VO
- `ApproverDashboardVo`：仪表盘主返回体，包含个人信息、总量、类型统计、月度统计。
- `ApprovalTypeStatVo`：记录 `appType`、中文 `typeLabel` 与统计数量。
- `MonthlyApprovalStatVo`：按 `yyyy-MM` 记录每月审批数量。

### 2.2 Service & Controller
- `ITaskService#getApproverDashboard(Long userId)`：新增接口定义。
- `TaskServiceImpl#getApproverDashboard`：
  - 查询当前审批人的已办任务（bpm_task.status=1）。
  - 关联申请信息、审批历史，统计：
    - 总处理量、同意数（action=1）、拒绝数（action=2）。
    - 各申请类型（leave / reimburse / other）数量。
    - 月度数量（按最新审批记录的 `approveTime`，回退 `finishTime`）。
  - 补充人员部门、岗位名称。
- `TaskController#getApproverDashboard`：暴露 `/task/dashboard` GET 接口，返回 `Result<ApproverDashboardVo>`。

## 3. 前端实现
位置：[frontend/src/pages/Approver](../frontend/src/pages/Approver)

### 3.1 数据类型 & API
- `src/types/index.ts`：新增 `ApproverDashboardSummary`、`ApprovalTypeStat`、`MonthlyApprovalStat`。
- `src/api/index.ts`：`taskApi.getApproverDashboard()` 调用后端接口。
- `package.json`：添加 `recharts` 依赖，用于折线图展示。

### 3.2 仪表盘页面
- 新增 `ApproverSummary.tsx`：
  - `useEffect` 调用 `taskApi.getApproverDashboard`，处理 loading/error。
  - 顶部“审批人信息”卡片显示姓名/部门/岗位/权限。
  - `metricCards` 渲染关键指标。
  - “按申请类型统计”以卡片列表展示 `typeStats`。
  - “按月审批趋势”使用 `ResponsiveContainer + LineChart` 渲染折线图，横轴 `month`，纵轴整数 `count`。
- `ApproverDashboard.tsx`：增加导航项“审批仪表盘”，默认路由 `/dashboard/summary` 指向 `ApproverSummary`。

### 3.3 交互说明
- 刷新失败时显示错误卡片并提供“重试”按钮。
- 无数据时展示骨架屏（loading）或空状态文案。
- 折线图无数据时提示“暂无审批趋势数据”。

## 4. 使用指南
1. **后端**：在 `approval-backend` 目录执行 `mvn spring-boot:run`（或 `mvn clean package`）。
2. **前端**：
   - 在 `frontend` 目录执行 `npm install`（安装 `recharts`）。
   - 运行 `npm run dev`，使用审批人账号登录。
3. 进入 “审批仪表盘” 页面即可查看统计结果。

## 5. 后续可扩展点
- 支持按时间段过滤仪表盘统计。
- 在类型卡片中加入环形图/比例信息。
- 折线图可切换为堆叠柱状图或按 `appType` 多线展示。
- 后端可缓存统计结果以减少实时计算压力。
