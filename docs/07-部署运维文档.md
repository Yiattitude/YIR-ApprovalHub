# å®¡æ‰¹ç³»ç»Ÿ - éƒ¨ç½²è¿ç»´æ–‡æ¡£

## 1. æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚

### 1.1 ç¡¬ä»¶é…ç½®ï¼ˆæ¨èï¼‰
- **CPU**ï¼š4æ ¸å¿ƒåŠä»¥ä¸Š
- **å†…å­˜**ï¼š8GB åŠä»¥ä¸Š
- **ç¡¬ç›˜**ï¼š100GB åŠä»¥ä¸Šï¼ˆSSD ä¼˜å…ˆï¼‰
- **ç½‘ç»œ**ï¼š100Mbps åŠä»¥ä¸Š

### 1.2 è½¯ä»¶ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 20.04 LTS / CentOS 7+ / Windows Server 2019+
- **Java**ï¼šJDK 17+
- **Node.js**ï¼š18.x+
- **MySQL**ï¼š8.0+
- **Redis**ï¼š6.0+ï¼ˆå¯é€‰ï¼‰
- **Nginx**ï¼š1.20+
- **Docker**ï¼š24.0+ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

## 2. éƒ¨ç½²æ–¹å¼

### 2.1 ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼

#### 2.1.1 åç«¯éƒ¨ç½²

**æ­¥éª¤1ï¼šå®‰è£… JDK**
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install openjdk-17-jdk -y

# CentOS/RHEL
sudo yum install java-17-openjdk-devel -y

# éªŒè¯å®‰è£…
java -version
```

**æ­¥éª¤2ï¼šå®‰è£… MySQL**
```bash
# Ubuntu
sudo apt install mysql-server -y

# CentOS
sudo yum install mysql-server -y

# å¯åŠ¨ MySQL
sudo systemctl start mysql
sudo systemctl enable mysql

# å®‰å…¨é…ç½®
sudo mysql_secure_installation
```

**æ­¥éª¤3ï¼šåˆ›å»ºæ•°æ®åº“**
```bash
mysql -u root -p

CREATE DATABASE approval_system DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
CREATE USER 'approval'@'localhost' IDENTIFIED BY 'YourPassword123!';
GRANT ALL PRIVILEGES ON approval_system.* TO 'approval'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

**æ­¥éª¤4ï¼šå¯¼å…¥æ•°æ®åº“è¡¨ç»“æ„**
```bash
mysql -u approval -p approval_system < database/init.sql
```

**æ­¥éª¤5ï¼šé…ç½®åç«¯åº”ç”¨**

ç¼–è¾‘ `application-prod.yml`ï¼š
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/approval_system?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: approval
    password: YourPassword123!
  
  data:
    redis:
      host: localhost
      port: 6379
      password: 
```

**æ­¥éª¤6ï¼šæ‰“åŒ…å¹¶è¿è¡Œ**
```bash
# æ‰“åŒ…
mvn clean package -DskipTests

# è¿è¡Œ
nohup java -jar target/approval-system-1.0.0.jar --spring.profiles.active=prod > app.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f app.log
```

**æ­¥éª¤7ï¼šé…ç½® Systemd æœåŠ¡ï¼ˆå¯é€‰ï¼‰**

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/approval-backend.service`ï¼š
```ini
[Unit]
Description=Approval System Backend
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/approval-backend
ExecStart=/usr/bin/java -jar /opt/approval-backend/approval-system-1.0.0.jar --spring.profiles.active=prod
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl enable approval-backend
sudo systemctl start approval-backend
sudo systemctl status approval-backend
```

#### 2.1.2 å‰ç«¯éƒ¨ç½²

**æ­¥éª¤1ï¼šå®‰è£… Node.js**
```bash
# Ubuntu
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node -v
npm -v
```

**æ­¥éª¤2ï¼šå®‰è£…ä¾èµ–å¹¶æ‰“åŒ…**
```bash
cd frontend
npm install
npm run build
```

**æ­¥éª¤3ï¼šå®‰è£… Nginx**
```bash
# Ubuntu
sudo apt install nginx -y

# CentOS
sudo yum install nginx -y

# å¯åŠ¨ Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

**æ­¥éª¤4ï¼šé…ç½® Nginx**

åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/approval-system`ï¼š
```nginx
server {
    listen 80;
    server_name approval.yourcompany.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    root /var/www/approval-frontend/dist;
    index index.html;
    
    # æ”¯æŒ Vue Router çš„ history æ¨¡å¼
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # åç«¯ API ä»£ç†
    location /api {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket æ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
    
    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 50M;
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/json application/xml+rss;
}
```

**æ­¥éª¤5ï¼šå¯ç”¨é…ç½®å¹¶é‡å¯ Nginx**
```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/approval-system /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

**æ­¥éª¤6ï¼šéƒ¨ç½²å‰ç«¯æ–‡ä»¶**
```bash
sudo mkdir -p /var/www/approval-frontend
sudo cp -r dist/* /var/www/approval-frontend/
sudo chown -R www-data:www-data /var/www/approval-frontend
```

### 2.2 Docker éƒ¨ç½²æ–¹å¼ï¼ˆæ¨èï¼‰

#### 2.2.1 åç«¯ Dockerfile

åˆ›å»º `backend/Dockerfile`ï¼š
```dockerfile
FROM maven:3.9-eclipse-temurin-17 AS build
WORKDIR /app
COPY pom.xml .
COPY src ./src
RUN mvn clean package -DskipTests

FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
COPY --from=build /app/target/approval-system-1.0.0.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar", "--spring.profiles.active=prod"]
```

#### 2.2.2 å‰ç«¯ Dockerfile

åˆ›å»º `frontend/Dockerfile`ï¼š
```dockerfile
FROM node:18-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

åˆ›å»º `frontend/nginx.conf`ï¼š
```nginx
server {
    listen 80;
    server_name localhost;
    
    root /usr/share/nginx/html;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location /api {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    client_max_body_size 50M;
    gzip on;
}
```

#### 2.2.3 Docker Compose é…ç½®

åˆ›å»º `docker-compose.yml`ï¼š
```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: approval-mysql
    environment:
      MYSQL_ROOT_PASSWORD: RootPassword123!
      MYSQL_DATABASE: approval_system
      MYSQL_USER: approval
      MYSQL_PASSWORD: ApprovalPassword123!
    volumes:
      - mysql-data:/var/lib/mysql
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"
    networks:
      - approval-network
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: approval-redis
    ports:
      - "6379:6379"
    networks:
      - approval-network
    restart: unless-stopped

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: approval-backend
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/approval_system?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
      SPRING_DATASOURCE_USERNAME: approval
      SPRING_DATASOURCE_PASSWORD: ApprovalPassword123!
      SPRING_REDIS_HOST: redis
    depends_on:
      - mysql
      - redis
    ports:
      - "8080:8080"
    networks:
      - approval-network
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: approval-frontend
    depends_on:
      - backend
    ports:
      - "80:80"
    networks:
      - approval-network
    restart: unless-stopped

volumes:
  mysql-data:

networks:
  approval-network:
    driver: bridge
```

#### 2.2.4 å¯åŠ¨ Docker æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart
```

## 3. HTTPS é…ç½®ï¼ˆä½¿ç”¨ Let's Encryptï¼‰

### 3.1 å®‰è£… Certbot

```bash
# Ubuntu
sudo apt install certbot python3-certbot-nginx -y

# CentOS
sudo yum install certbot python3-certbot-nginx -y
```

### 3.2 è·å– SSL è¯ä¹¦

```bash
sudo certbot --nginx -d approval.yourcompany.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### 3.3 é…ç½®è‡ªåŠ¨ç»­æœŸ

```bash
# æ·»åŠ å®šæ—¶ä»»åŠ¡
sudo crontab -e

# æ¯æœˆ1å·å‡Œæ™¨3ç‚¹æ£€æŸ¥å¹¶ç»­æœŸ
0 3 1 * * certbot renew --quiet --post-hook "systemctl reload nginx"
```

## 4. ç›‘æ§ä¸æ—¥å¿—

### 4.1 åº”ç”¨æ—¥å¿—

**åç«¯æ—¥å¿—é…ç½®** (`application-prod.yml`)ï¼š
```yaml
logging:
  file:
    name: /var/log/approval-backend/application.log
    max-size: 100MB
    max-history: 30
  level:
    root: INFO
    com.approval: INFO
```

**æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
# å®æ—¶æŸ¥çœ‹
tail -f /var/log/approval-backend/application.log

# æŸ¥è¯¢é”™è¯¯æ—¥å¿—
grep "ERROR" /var/log/approval-backend/application.log

# æŒ‰æ—¥æœŸæŸ¥è¯¢
grep "2026-01-14" /var/log/approval-backend/application.log
```

### 4.2 Nginx æ—¥å¿—

**è®¿é—®æ—¥å¿—**ï¼š
```bash
tail -f /var/log/nginx/access.log
```

**é”™è¯¯æ—¥å¿—**ï¼š
```bash
tail -f /var/log/nginx/error.log
```

### 4.3 æ•°æ®åº“ç›‘æ§

**MySQL æ…¢æŸ¥è¯¢æ—¥å¿—**ï¼š

ç¼–è¾‘ `/etc/mysql/mysql.conf.d/mysqld.cnf`ï¼š
```ini
slow_query_log = 1
slow_query_log_file = /var/log/mysql/mysql-slow.log
long_query_time = 2
```

æŸ¥çœ‹æ…¢æŸ¥è¯¢ï¼š
```bash
tail -f /var/log/mysql/mysql-slow.log
```

## 5. å¤‡ä»½ç­–ç•¥

### 5.1 æ•°æ®åº“å¤‡ä»½è„šæœ¬

åˆ›å»º `/opt/scripts/backup-mysql.sh`ï¼š
```bash
#!/bin/bash

BACKUP_DIR="/data/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="approval_system"
DB_USER="approval"
DB_PASSWORD="ApprovalPassword123!"

mkdir -p ${BACKUP_DIR}

mysqldump -u ${DB_USER} -p${DB_PASSWORD} ${DB_NAME} | gzip > ${BACKUP_DIR}/${DB_NAME}_${DATE}.sql.gz

# åˆ é™¤30å¤©å‰çš„å¤‡ä»½
find ${BACKUP_DIR} -name "*.sql.gz" -mtime +30 -delete

echo "Backup completed: ${BACKUP_DIR}/${DB_NAME}_${DATE}.sql.gz"
```

è®¾ç½®æ‰§è¡Œæƒé™ï¼š
```bash
chmod +x /opt/scripts/backup-mysql.sh
```

æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼š
```bash
sudo crontab -e

# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /opt/scripts/backup-mysql.sh >> /var/log/mysql-backup.log 2>&1
```

### 5.2 æ–‡ä»¶å¤‡ä»½

**ä¸Šä¼ æ–‡ä»¶å¤‡ä»½è„šæœ¬** `/opt/scripts/backup-files.sh`ï¼š
```bash
#!/bin/bash

UPLOAD_DIR="/var/www/approval-backend/upload"
BACKUP_DIR="/data/backup/files"
DATE=$(date +%Y%m%d)

mkdir -p ${BACKUP_DIR}

tar -czf ${BACKUP_DIR}/upload_${DATE}.tar.gz ${UPLOAD_DIR}

# åˆ é™¤30å¤©å‰çš„å¤‡ä»½
find ${BACKUP_DIR} -name "upload_*.tar.gz" -mtime +30 -delete

echo "Files backup completed"
```

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 æ•°æ®åº“ä¼˜åŒ–

**MySQL é…ç½®ä¼˜åŒ–** (`/etc/mysql/mysql.conf.d/mysqld.cnf`)ï¼š
```ini
[mysqld]
# è¿æ¥æ± é…ç½®
max_connections = 500
max_connect_errors = 1000

# ç¼“å†²æ± é…ç½®ï¼ˆæ ¹æ®æœåŠ¡å™¨å†…å­˜è°ƒæ•´ï¼‰
innodb_buffer_pool_size = 2G
innodb_log_file_size = 256M

# æŸ¥è¯¢ç¼“å­˜
query_cache_size = 128M
query_cache_type = 1

# ä¸´æ—¶è¡¨
tmp_table_size = 64M
max_heap_table_size = 64M
```

### 6.2 åº”ç”¨ä¼˜åŒ–

**JVM å‚æ•°ä¼˜åŒ–**ï¼š
```bash
java -Xms2g -Xmx2g -XX:+UseG1GC -jar approval-system-1.0.0.jar
```

**åç«¯é…ç½®ä¼˜åŒ–**ï¼š
```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
```

### 6.3 Nginx ä¼˜åŒ–

```nginx
# å·¥ä½œè¿›ç¨‹æ•°ï¼ˆé€šå¸¸è®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°ï¼‰
worker_processes auto;

# æ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°
events {
    worker_connections 2048;
    use epoll;
}

http {
    # å¼€å¯ Gzip
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_comp_level 6;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
    
    # è¿æ¥è¶…æ—¶
    keepalive_timeout 65;
    
    # ç¼“å­˜
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=1g inactive=60m;
}
```

## 7. å®‰å…¨åŠ å›º

### 7.1 é˜²ç«å¢™é…ç½®

```bash
# Ubuntu (ufw)
sudo ufw enable
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS

# CentOS (firewalld)
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### 7.2 MySQL å®‰å…¨

```bash
# ç¦æ­¢ root è¿œç¨‹ç™»å½•
mysql -u root -p
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');
FLUSH PRIVILEGES;

# ä¿®æ”¹é»˜è®¤ç«¯å£ï¼ˆå¯é€‰ï¼‰
# ç¼–è¾‘ /etc/mysql/mysql.conf.d/mysqld.cnf
port = 3307
```

### 7.3 åº”ç”¨å®‰å…¨

- å®šæœŸæ›´æ–°ä¾èµ–åº“
- é…ç½® HTTPS
- å¯ç”¨ CORS ç™½åå•
- ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥
- å®šæœŸå®¡è®¡æ—¥å¿—

## 8. æ•…éšœæ’æŸ¥

### 8.1 å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šåç«¯æ— æ³•è¿æ¥æ•°æ®åº“**
```bash
# æ£€æŸ¥ MySQL çŠ¶æ€
sudo systemctl status mysql

# æ£€æŸ¥ç«¯å£
netstat -anp | grep 3306

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

**é—®é¢˜2ï¼šå‰ç«¯æ— æ³•è®¿é—®åç«¯ API**
```bash
# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log

# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
ps aux | grep java
```

**é—®é¢˜3ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥**
```bash
# æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
ls -la /var/www/approval-backend/upload

# ä¿®æ”¹æƒé™
sudo chown -R www-data:www-data /var/www/approval-backend/upload
sudo chmod -R 755 /var/www/approval-backend/upload
```

### 8.2 æ€§èƒ½é—®é¢˜æ’æŸ¥

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
top
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ MySQL è¿›ç¨‹
SHOW FULL PROCESSLIST;

# æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log ORDER BY start_time DESC LIMIT 10;
```

## 9. å‡çº§éƒ¨ç½²æµç¨‹

### 9.1 æ»šåŠ¨æ›´æ–°ï¼ˆé›¶åœæœºï¼‰

**æ­¥éª¤1ï¼šå¤‡ä»½æ•°æ®åº“**
```bash
/opt/scripts/backup-mysql.sh
```

**æ­¥éª¤2ï¼šå¤‡ä»½å½“å‰ç‰ˆæœ¬**
```bash
cp approval-system-1.0.0.jar approval-system-1.0.0.jar.bak
```

**æ­¥éª¤3ï¼šä¸Šä¼ æ–°ç‰ˆæœ¬**
```bash
scp approval-system-1.1.0.jar user@server:/opt/approval-backend/
```

**æ­¥éª¤4ï¼šæ›´æ–°å¹¶é‡å¯**
```bash
sudo systemctl stop approval-backend
mv approval-system-1.1.0.jar approval-system-1.0.0.jar
sudo systemctl start approval-backend
```

**æ­¥éª¤5ï¼šéªŒè¯**
```bash
curl http://localhost:8080/api/health
tail -f /var/log/approval-backend/application.log
```

### 9.2 Docker æ›´æ–°

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºé•œåƒ
docker-compose build

# æ»šåŠ¨æ›´æ–°
docker-compose up -d --no-deps --build backend
docker-compose up -d --no-deps --build frontend
```

---

> ğŸ“… **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
> ğŸ“ **æœ€åæ›´æ–°**ï¼š2026-01-14  
> ğŸ‘¤ **ç¼–å†™äºº**ï¼šè¿ç»´å·¥ç¨‹å¸ˆ
