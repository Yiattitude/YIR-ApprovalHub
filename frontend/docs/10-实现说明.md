# 普通员工界面与权限调整实现说明

## 1. 背景
为满足“普通员工仅可查看和操作自己发起的申请，并将界面聚焦在我的申请/审批历史/仪表盘”需求，项目完成了后端权限增强与前端界面重构。本说明文档面向交付与测试团队，帮助快速了解本次改动内容及验证要点。

## 2. 实施范围
- **权限限制**：我的申请页仅展示本人且状态为“待审批”的记录。
- **审批历史**：新增可筛选的历史列表，用于承载已通过/已拒绝记录。
- **个人仪表盘**：提供申请统计、请假/报销拆分、审批通过率及快速发起入口。
- **接口扩展**：`/application/history` 与 `/application/summary` 为核心数据来源，并扩展登录返回的部门/岗位/角色信息以丰富展示。

## 3. 后端改动概览
| 模块 | 说明 |
| --- | --- |
| `IApplicationService` | 新增 `status` 参数用于历史筛选；新增 `getMySummary` 汇总统计。 |
| `ApplicationServiceImpl` | 1) 历史查询支持结果过滤、按需拼装请假/报销详情；2) 汇总统计计算总量/待审批/通过率/请假天数/报销金额；3) 登录返回携带部门与岗位名称。 |
| `ApplicationController` | `/application/history` 新增 `status` 入参；`/application/summary` 返回 `ApplicationSummaryVo`。 |
| VO/实体 | 新增 `ApplicationHistoryVo`、`ApplicationSummaryVo`、`Dept`、`Post`，并在 `LoginVo` 注入 `deptName/postName/roleLabel`。 |

## 4. 前端改动概览
| 页面/模块 | 说明 |
| --- | --- |
| `Dashboard` | 侧边栏精简为“我的申请 / 审批历史 / 仪表盘”，默认进入仪表盘。 |
| `MyApplications` | 固定查询条件 `status=1`，只保留类型筛选并提示用户历史入口。 |
| `ApprovalHistory`（新） | 调用 `/application/history`，提供状态下拉、顶部统计卡片及审批记录表格。 |
| `EmployeeSummary`（新） | 调用 `/application/summary`，展示个人信息、申请统计、请假/报销拆分与审批通过率，附带快速发起按钮。 |
| API/类型 | `applicationApi` 新增 `getHistoryApplications` `status` 参数与 `getSummary` 调用；`ApplicationSummary`/`ApplicationHistory` 类型同步。 |

## 5. 接口调用说明
- **我的申请**：`GET /application/my?status=1&appType=leave|reimburse`，分页固定 `pageSize=20`。
- **审批历史**：`GET /application/history`，可选参数 `status (3=已通过,4=已拒绝)`、`leaveType`、`expenseType`、`approverName`、`startTime`、`endTime`。前端目前使用状态筛选，并保留分页与后续扩展空间。
- **仪表盘统计**：`GET /application/summary`，返回个人信息与各项统计指标。

## 6. 验证建议
1. 使用普通员工账号登录，确认：
   - “我的申请”仅出现本人、状态=待审批的记录；状态提示正确。
   - 尝试直接访问其他用户申请详情应被后端拒绝（若有路由直接拼接）。
2. 创建一条请假与报销申请，完成审批流程后检查：
   - 审批历史可按“已通过/已拒绝”切换并显示审批人、备注、完成时间。
   - 仪表盘“总申请数/待审批/通过/拒绝”随数据变化；请假天数和报销金额累计准确，审批通过率显示两位小数。
3. 验证登录响应包含 `deptName/postName` 信息，仪表盘个人信息部分随用户变更实时更新。

## 7. 后续可选优化
- 审批历史增加时间范围与类型筛选 UI，并支持导出。
- 仪表盘补充趋势图或最近操作动态。
- “我的申请”支持自定义分页及排序，提升列表体验。

> 本文档适用于 2026-01-15 版本，若后续迭代涉及权限或界面调整，请同步更新。